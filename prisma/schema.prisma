generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model DonationItem {
  id       String  @id @default(cuid())
  itemId   String  @unique // ID original do item (ex: 'sex-milho-1')
  name     String // Nome do item
  category String // Categoria (ex: 'Caldo de milho')
  day      String // Dia do evento
  meal     String // Refeição
  donated  Boolean @default(false)

  // ========== NOVOS CAMPOS PARA DOAÇÕES PARCIAIS ==========
  requiresQuantity Boolean @default(false) // true se for medido em kg/litros
  totalQuantity    Float? // quantidade total necessária (ex: 5 kg)
  donatedQuantity  Float   @default(0) // quantidade já doada acumulada
  unit             String? // "kg", "litros", etc.
  // ========================================================

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com doações (agora pode ter várias doações parciais)
  donations Donation[]

  @@index([day])
  @@index([category])
  @@index([donated])
  @@index([requiresQuantity])
}

model Donation {
  id           String   @id @default(cuid())
  donorName    String // Nome do doador
  donorPhone   String // Telefone do doador
  donorObs     String? // Observação opcional
  donationType String // 'Item' ou 'PIX'
  donationDate DateTime @default(now())

  // ========== NOVOS CAMPOS PARA DOAÇÕES PARCIAIS ==========
  isPartialDonation Boolean @default(false) // true se for doação parcial
  partialQuantity   Float? // quantidade doada (se parcial)
  // ========================================================

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com item doado (MODIFICADO: removido @unique para permitir múltiplas doações)
  donationItem   DonationItem @relation(fields: [donationItemId], references: [id], onDelete: Cascade)
  donationItemId String

  // Comprovante PIX (opcional)
  pixReceipt PixReceipt?

  @@index([donorPhone])
  @@index([donationType])
  @@index([donationDate])
  @@index([isPartialDonation])
}

model PixReceipt {
  id         String   @id @default(cuid())
  fileName   String // Nome original do arquivo
  fileUrl    String // URL ou caminho do arquivo salvo
  fileSize   Int // Tamanho do arquivo em bytes
  mimeType   String // Tipo MIME (ex: 'image/jpeg')
  uploadedAt DateTime @default(now())

  // Relacionamento com doação
  donation   Donation @relation(fields: [donationId], references: [id], onDelete: Cascade)
  donationId String   @unique

  @@index([uploadedAt])
}

// Tabela opcional para logs de atividades
model ActivityLog {
  id          String   @id @default(cuid())
  action      String // 'DONATION_CREATED', 'DONATION_CANCELLED', etc.
  description String
  metadata    Json? // Dados adicionais em JSON
  createdAt   DateTime @default(now())

  @@index([action])
  @@index([createdAt])
}
